<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>controllers/reporte_controller.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CategoriasController.html">CategoriasController</a><ul class='methods'><li data-type='method'><a href="CategoriasController.html#.activarCategoria">activarCategoria</a></li><li data-type='method'><a href="CategoriasController.html#.buscarCategoria">buscarCategoria</a></li><li data-type='method'><a href="CategoriasController.html#.crearCategoria">crearCategoria</a></li><li data-type='method'><a href="CategoriasController.html#.editarCategoria">editarCategoria</a></li><li data-type='method'><a href="CategoriasController.html#.listarCategorias">listarCategorias</a></li><li data-type='method'><a href="CategoriasController.html#.obtenerTotalCategorias">obtenerTotalCategorias</a></li></ul></li><li><a href="CategoryTableComponent.html">CategoryTableComponent</a><ul class='methods'><li data-type='method'><a href="CategoryTableComponent.html#activeCategory">activeCategory</a></li><li data-type='method'><a href="CategoryTableComponent.html#createCategory">createCategory</a></li><li data-type='method'><a href="CategoryTableComponent.html#editCategory">editCategory</a></li><li data-type='method'><a href="CategoryTableComponent.html#getAll">getAll</a></li><li data-type='method'><a href="CategoryTableComponent.html#getName">getName</a></li><li data-type='method'><a href="CategoryTableComponent.html#openModalConfirm">openModalConfirm</a></li><li data-type='method'><a href="CategoryTableComponent.html#render">render</a></li><li data-type='method'><a href="CategoryTableComponent.html#searchCategories">searchCategories</a></li><li data-type='method'><a href="CategoryTableComponent.html#selectCategory">selectCategory</a></li><li data-type='method'><a href="CategoryTableComponent.html#setRows">setRows</a></li></ul></li><li><a href="ClientesController.html">ClientesController</a><ul class='methods'><li data-type='method'><a href="ClientesController.html#.buscarCliente">buscarCliente</a></li><li data-type='method'><a href="ClientesController.html#.crearCliente">crearCliente</a></li><li data-type='method'><a href="ClientesController.html#.editarCliente">editarCliente</a></li><li data-type='method'><a href="ClientesController.html#.listarClientes">listarClientes</a></li><li data-type='method'><a href="ClientesController.html#.obtenerTotalClientes">obtenerTotalClientes</a></li></ul></li><li><a href="ClientsTableComponent.html">ClientsTableComponent</a><ul class='methods'><li data-type='method'><a href="ClientsTableComponent.html#addClient">addClient</a></li><li data-type='method'><a href="ClientsTableComponent.html#editClient">editClient</a></li><li data-type='method'><a href="ClientsTableComponent.html#getAll">getAll</a></li><li data-type='method'><a href="ClientsTableComponent.html#renderClients">renderClients</a></li><li data-type='method'><a href="ClientsTableComponent.html#searchClient">searchClient</a></li><li data-type='method'><a href="ClientsTableComponent.html#setEvents">setEvents</a></li><li data-type='method'><a href="ClientsTableComponent.html#setRows">setRows</a></li></ul></li><li><a href="Database.html">Database</a><ul class='methods'><li data-type='method'><a href="Database.html#.closeConnection">closeConnection</a></li><li data-type='method'><a href="Database.html#.connect">connect</a></li><li data-type='method'><a href="Database.html#.sqlParse">sqlParse</a></li><li data-type='method'><a href="Database.html#consult">consult</a></li><li data-type='method'><a href="Database.html#delete">delete</a></li><li data-type='method'><a href="Database.html#find">find</a></li><li data-type='method'><a href="Database.html#getTotalRecords">getTotalRecords</a></li><li data-type='method'><a href="Database.html#insert">insert</a></li><li data-type='method'><a href="Database.html#update">update</a></li></ul></li><li><a href="HomeComponent.html">HomeComponent</a><ul class='methods'><li data-type='method'><a href="HomeComponent.html#initCards">initCards</a></li><li data-type='method'><a href="HomeComponent.html#logOut">logOut</a></li><li data-type='method'><a href="HomeComponent.html#openEstadistics">openEstadistics</a></li><li data-type='method'><a href="HomeComponent.html#openOrders">openOrders</a></li><li data-type='method'><a href="HomeComponent.html#openProducts">openProducts</a></li><li data-type='method'><a href="HomeComponent.html#openUsers">openUsers</a></li><li data-type='method'><a href="HomeComponent.html#reduceValues">reduceValues</a></li><li data-type='method'><a href="HomeComponent.html#showOptions">showOptions</a></li></ul></li><li><a href="LoadingComponent.html">LoadingComponent</a><ul class='methods'><li data-type='method'><a href="LoadingComponent.html#attributeChangedCallback">attributeChangedCallback</a></li><li data-type='method'><a href="LoadingComponent.html#connectedCallback">connectedCallback</a></li><li data-type='method'><a href="LoadingComponent.html#render">render</a></li><li data-type='method'><a href="LoadingComponent.html#setSizeLoading">setSizeLoading</a></li></ul></li><li><a href="LoginView.html">LoginView</a><ul class='methods'><li data-type='method'><a href="LoginView.html#handleSubmit">handleSubmit</a></li><li data-type='method'><a href="LoginView.html#hideLoading">hideLoading</a></li><li data-type='method'><a href="LoginView.html#loading">loading</a></li><li data-type='method'><a href="LoginView.html#login">login</a></li><li data-type='method'><a href="LoginView.html#renderErrors">renderErrors</a></li><li data-type='method'><a href="LoginView.html#resetLoginForm">resetLoginForm</a></li><li data-type='method'><a href="LoginView.html#validateForm">validateForm</a></li></ul></li><li><a href="ModalClientComponent.html">ModalClientComponent</a><ul class='methods'><li data-type='method'><a href="ModalClientComponent.html#checkClient">checkClient</a></li><li data-type='method'><a href="ModalClientComponent.html#closeModalClients">closeModalClients</a></li><li data-type='method'><a href="ModalClientComponent.html#handleChange">handleChange</a></li><li data-type='method'><a href="ModalClientComponent.html#openModalClients">openModalClients</a></li><li data-type='method'><a href="ModalClientComponent.html#renderClients">renderClients</a></li><li data-type='method'><a href="ModalClientComponent.html#searchClient">searchClient</a></li><li data-type='method'><a href="ModalClientComponent.html#setEvents">setEvents</a></li></ul></li><li><a href="ModalProductsComponent.html">ModalProductsComponent</a><ul class='methods'><li data-type='method'><a href="ModalProductsComponent.html#checkProduct">checkProduct</a></li><li data-type='method'><a href="ModalProductsComponent.html#closeModalProducts">closeModalProducts</a></li><li data-type='method'><a href="ModalProductsComponent.html#handleChange">handleChange</a></li><li data-type='method'><a href="ModalProductsComponent.html#openModalProducts">openModalProducts</a></li><li data-type='method'><a href="ModalProductsComponent.html#renderProducts">renderProducts</a></li><li data-type='method'><a href="ModalProductsComponent.html#searchProduct">searchProduct</a></li><li data-type='method'><a href="ModalProductsComponent.html#setEvents">setEvents</a></li></ul></li><li><a href="NotasController.html">NotasController</a><ul class='methods'><li data-type='method'><a href="NotasController.html#.actualizarNota">actualizarNota</a></li><li data-type='method'><a href="NotasController.html#.buscarNota">buscarNota</a></li><li data-type='method'><a href="NotasController.html#.calcularTotalNotas">calcularTotalNotas</a></li><li data-type='method'><a href="NotasController.html#.crearNota">crearNota</a></li><li data-type='method'><a href="NotasController.html#.generarPDFNota">generarPDFNota</a></li><li data-type='method'><a href="NotasController.html#.listarNotas">listarNotas</a></li><li data-type='method'><a href="NotasController.html#.mostrarAlerta">mostrarAlerta</a></li><li data-type='method'><a href="NotasController.html#.obtenerNota">obtenerNota</a></li><li data-type='method'><a href="NotasController.html#.obtenerTotalNotas">obtenerTotalNotas</a></li><li data-type='method'><a href="NotasController.html#.obtenerUltimaNota">obtenerUltimaNota</a></li></ul></li><li><a href="NotasProductosController.html">NotasProductosController</a><ul class='methods'><li data-type='method'><a href="NotasProductosController.html#.actualizarNotasProductos">actualizarNotasProductos</a></li><li data-type='method'><a href="NotasProductosController.html#.insertarNotasProductos">insertarNotasProductos</a></li><li data-type='method'><a href="NotasProductosController.html#.restarCantidad">restarCantidad</a></li><li data-type='method'><a href="NotasProductosController.html#.retirarProductoNota">retirarProductoNota</a></li><li data-type='method'><a href="NotasProductosController.html#.sumarCantidad">sumarCantidad</a></li></ul></li><li><a href="OrdersForm.html">OrdersForm</a><ul class='methods'><li data-type='method'><a href="OrdersForm.html#calculateTotal">calculateTotal</a></li><li data-type='method'><a href="OrdersForm.html#confirmDeleteClient">confirmDeleteClient</a></li><li data-type='method'><a href="OrdersForm.html#confirmDeleteProduct">confirmDeleteProduct</a></li><li data-type='method'><a href="OrdersForm.html#deleteClient">deleteClient</a></li><li data-type='method'><a href="OrdersForm.html#deleteProduct">deleteProduct</a></li><li data-type='method'><a href="OrdersForm.html#getDeliveryNote">getDeliveryNote</a></li><li data-type='method'><a href="OrdersForm.html#getParamsUrl">getParamsUrl</a></li><li data-type='method'><a href="OrdersForm.html#handleChangeQuantity">handleChangeQuantity</a></li><li data-type='method'><a href="OrdersForm.html#handleSubmit">handleSubmit</a></li><li data-type='method'><a href="OrdersForm.html#resetForm">resetForm</a></li><li data-type='method'><a href="OrdersForm.html#selectClients">selectClients</a></li><li data-type='method'><a href="OrdersForm.html#selectProducts">selectProducts</a></li><li data-type='method'><a href="OrdersForm.html#sendData">sendData</a></li><li data-type='method'><a href="OrdersForm.html#setClientsTable">setClientsTable</a></li><li data-type='method'><a href="OrdersForm.html#setForm">setForm</a></li><li data-type='method'><a href="OrdersForm.html#setHtml">setHtml</a></li><li data-type='method'><a href="OrdersForm.html#setProductsTable">setProductsTable</a></li><li data-type='method'><a href="OrdersForm.html#validateForm">validateForm</a></li></ul></li><li><a href="OrdersTableComponent.html">OrdersTableComponent</a><ul class='methods'><li data-type='method'><a href="OrdersTableComponent.html#createDeliveryNote">createDeliveryNote</a></li><li data-type='method'><a href="OrdersTableComponent.html#editDeiliveryNote">editDeiliveryNote</a></li><li data-type='method'><a href="OrdersTableComponent.html#getAll">getAll</a></li><li data-type='method'><a href="OrdersTableComponent.html#getName">getName</a></li><li data-type='method'><a href="OrdersTableComponent.html#render">render</a></li><li data-type='method'><a href="OrdersTableComponent.html#searchDeliveryNote">searchDeliveryNote</a></li><li data-type='method'><a href="OrdersTableComponent.html#setEvents">setEvents</a></li><li data-type='method'><a href="OrdersTableComponent.html#setRows">setRows</a></li><li data-type='method'><a href="OrdersTableComponent.html#showPDF">showPDF</a></li></ul></li><li><a href="PaginationComponentElement.html">PaginationComponentElement</a><ul class='methods'><li data-type='method'><a href="PaginationComponentElement.html#attributeChangedCallback">attributeChangedCallback</a></li><li data-type='method'><a href="PaginationComponentElement.html#next">next</a></li><li data-type='method'><a href="PaginationComponentElement.html#prev">prev</a></li><li data-type='method'><a href="PaginationComponentElement.html#render">render</a></li><li data-type='method'><a href="PaginationComponentElement.html#sendPagination">sendPagination</a></li></ul></li><li><a href="PdfController.html">PdfController</a><ul class='methods'><li data-type='method'><a href="PdfController.html#crearReporte">crearReporte</a></li><li data-type='method'><a href="PdfController.html#createPdf">createPdf</a></li></ul></li><li><a href="ProductosController.html">ProductosController</a><ul class='methods'><li data-type='method'><a href="ProductosController.html#.activarProducto">activarProducto</a></li><li data-type='method'><a href="ProductosController.html#.buscarProducto">buscarProducto</a></li><li data-type='method'><a href="ProductosController.html#.crearProducto">crearProducto</a></li><li data-type='method'><a href="ProductosController.html#.editarCantidadProducto">editarCantidadProducto</a></li><li data-type='method'><a href="ProductosController.html#.editarProducto">editarProducto</a></li><li data-type='method'><a href="ProductosController.html#.listarCategorias">listarCategorias</a></li><li data-type='method'><a href="ProductosController.html#.listarProductos">listarProductos</a></li><li data-type='method'><a href="ProductosController.html#.listarProductosActivos">listarProductosActivos</a></li><li data-type='method'><a href="ProductosController.html#.obtenerTotalProductos">obtenerTotalProductos</a></li><li data-type='method'><a href="ProductosController.html#.obtenerTotalProductosActivos">obtenerTotalProductosActivos</a></li></ul></li><li><a href="ProductsTableComponent.html">ProductsTableComponent</a><ul class='methods'><li data-type='method'><a href="ProductsTableComponent.html#activeProduct">activeProduct</a></li><li data-type='method'><a href="ProductsTableComponent.html#createProduct">createProduct</a></li><li data-type='method'><a href="ProductsTableComponent.html#editProduct">editProduct</a></li><li data-type='method'><a href="ProductsTableComponent.html#getAll">getAll</a></li><li data-type='method'><a href="ProductsTableComponent.html#openModalConfirm">openModalConfirm</a></li><li data-type='method'><a href="ProductsTableComponent.html#render">render</a></li><li data-type='method'><a href="ProductsTableComponent.html#searchProducts">searchProducts</a></li><li data-type='method'><a href="ProductsTableComponent.html#selectProduct">selectProduct</a></li><li data-type='method'><a href="ProductsTableComponent.html#setName">setName</a></li><li data-type='method'><a href="ProductsTableComponent.html#setRows">setRows</a></li></ul></li><li><a href="ProfileModalComponent.html">ProfileModalComponent</a><ul class='methods'><li data-type='method'><a href="ProfileModalComponent.html#handleSubmit">handleSubmit</a></li><li data-type='method'><a href="ProfileModalComponent.html#openModalProfile">openModalProfile</a></li><li data-type='method'><a href="ProfileModalComponent.html#resetForm">resetForm</a></li><li data-type='method'><a href="ProfileModalComponent.html#setForm">setForm</a></li><li data-type='method'><a href="ProfileModalComponent.html#setHtml">setHtml</a></li><li data-type='method'><a href="ProfileModalComponent.html#validate">validate</a></li></ul></li><li><a href="ReporteController.html">ReporteController</a><ul class='methods'><li data-type='method'><a href="ReporteController.html#.buscarCantidadMaximaVendida">buscarCantidadMaximaVendida</a></li><li data-type='method'><a href="ReporteController.html#.buscarCantidadProductosVendidosAnual">buscarCantidadProductosVendidosAnual</a></li><li data-type='method'><a href="ReporteController.html#.buscarNotasCategoria">buscarNotasCategoria</a></li><li data-type='method'><a href="ReporteController.html#.buscarNotasVendidasPorVendedor">buscarNotasVendidasPorVendedor</a></li><li data-type='method'><a href="ReporteController.html#.buscarTotalProductosPorCategoria">buscarTotalProductosPorCategoria</a></li><li data-type='method'><a href="ReporteController.html#.generarReporte">generarReporte</a></li><li data-type='method'><a href="ReporteController.html#.getImageBuffer">getImageBuffer</a></li><li data-type='method'><a href="ReporteController.html#.ordenarMeses">ordenarMeses</a></li></ul></li><li><a href="ReportPDF.html">ReportPDF</a><ul class='methods'><li data-type='method'><a href="ReportPDF.html#createBarChart">createBarChart</a></li><li data-type='method'><a href="ReportPDF.html#createLineChart">createLineChart</a></li><li data-type='method'><a href="ReportPDF.html#createPieChart">createPieChart</a></li><li data-type='method'><a href="ReportPDF.html#createRandomColor">createRandomColor</a></li><li data-type='method'><a href="ReportPDF.html#transformBase64toArrayBuffer">transformBase64toArrayBuffer</a></li></ul></li><li><a href="ReportsComponent.html">ReportsComponent</a><ul class='methods'><li data-type='method'><a href="ReportsComponent.html#clearFilter">clearFilter</a></li><li data-type='method'><a href="ReportsComponent.html#createBarChart">createBarChart</a></li><li data-type='method'><a href="ReportsComponent.html#createLineChart">createLineChart</a></li><li data-type='method'><a href="ReportsComponent.html#createPieChart">createPieChart</a></li><li data-type='method'><a href="ReportsComponent.html#createRandomColor">createRandomColor</a></li><li data-type='method'><a href="ReportsComponent.html#deleteCharts">deleteCharts</a></li><li data-type='method'><a href="ReportsComponent.html#generateReport">generateReport</a></li><li data-type='method'><a href="ReportsComponent.html#generateStadistics">generateStadistics</a></li><li data-type='method'><a href="ReportsComponent.html#handleChangeBusiness">handleChangeBusiness</a></li><li data-type='method'><a href="ReportsComponent.html#handleChangeQuestions">handleChangeQuestions</a></li><li data-type='method'><a href="ReportsComponent.html#resetForm">resetForm</a></li><li data-type='method'><a href="ReportsComponent.html#setEvents">setEvents</a></li><li data-type='method'><a href="ReportsComponent.html#showPeriod">showPeriod</a></li><li data-type='method'><a href="ReportsComponent.html#validate">validate</a></li></ul></li><li><a href="SearchBarComponent.html">SearchBarComponent</a><ul class='methods'><li data-type='method'><a href="SearchBarComponent.html#connectedCallback">connectedCallback</a></li><li data-type='method'><a href="SearchBarComponent.html#disconnectedCallback">disconnectedCallback</a></li><li data-type='method'><a href="SearchBarComponent.html#getHtml">getHtml</a></li><li data-type='method'><a href="SearchBarComponent.html#handleChangeInput">handleChangeInput</a></li></ul></li><li><a href="UsersComponent.html">UsersComponent</a><ul class='methods'><li data-type='method'><a href="UsersComponent.html#changeView">changeView</a></li><li data-type='method'><a href="UsersComponent.html#setHtml">setHtml</a></li><li data-type='method'><a href="UsersComponent.html#setOptionsTabs">setOptionsTabs</a></li></ul></li><li><a href="UsersController.html">UsersController</a><ul class='methods'><li data-type='method'><a href="UsersController.html#.actualizarPerfil">actualizarPerfil</a></li><li data-type='method'><a href="UsersController.html#.buscarUsuarios">buscarUsuarios</a></li><li data-type='method'><a href="UsersController.html#.cambiarEstadoUsuarios">cambiarEstadoUsuarios</a></li><li data-type='method'><a href="UsersController.html#.cambiarRolUsuarios">cambiarRolUsuarios</a></li><li data-type='method'><a href="UsersController.html#.crearUsuario">crearUsuario</a></li><li data-type='method'><a href="UsersController.html#.listarUsuarios">listarUsuarios</a></li><li data-type='method'><a href="UsersController.html#.login">login</a></li><li data-type='method'><a href="UsersController.html#.obtenerTotalUsuarios">obtenerTotalUsuarios</a></li></ul></li><li><a href="UsersTableComponent.html">UsersTableComponent</a><ul class='methods'><li data-type='method'><a href="UsersTableComponent.html#changeRole">changeRole</a></li><li data-type='method'><a href="UsersTableComponent.html#deleteUser">deleteUser</a></li><li data-type='method'><a href="UsersTableComponent.html#getAll">getAll</a></li><li data-type='method'><a href="UsersTableComponent.html#getRowTable">getRowTable</a></li><li data-type='method'><a href="UsersTableComponent.html#newUser">newUser</a></li><li data-type='method'><a href="UsersTableComponent.html#openModalConfirm">openModalConfirm</a></li><li data-type='method'><a href="UsersTableComponent.html#renderUsers">renderUsers</a></li><li data-type='method'><a href="UsersTableComponent.html#searchUser">searchUser</a></li><li data-type='method'><a href="UsersTableComponent.html#setEvents">setEvents</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-file.html">file</a><ul class='methods'><li data-type='method'><a href="module-file.html#~appendFile">appendFile</a></li><li data-type='method'><a href="module-file.html#~checkAsset">checkAsset</a></li><li data-type='method'><a href="module-file.html#~copyFile">copyFile</a></li><li data-type='method'><a href="module-file.html#~deleteFileSync">deleteFileSync</a></li><li data-type='method'><a href="module-file.html#~formatUrl">formatUrl</a></li><li data-type='method'><a href="module-file.html#~getHomePath">getHomePath</a></li><li data-type='method'><a href="module-file.html#~readFile">readFile</a></li><li data-type='method'><a href="module-file.html#~readFileAssets">readFileAssets</a></li><li data-type='method'><a href="module-file.html#~readFileImageAsync">readFileImageAsync</a></li><li data-type='method'><a href="module-file.html#~writeFile">writeFile</a></li></ul></li><li><a href="module-ModalCategoryFormComponent.html">ModalCategoryFormComponent</a><ul class='methods'><li data-type='method'><a href="module-ModalCategoryFormComponent.html#~cleanFormOnClose">cleanFormOnClose</a></li><li data-type='method'><a href="module-ModalCategoryFormComponent.html#~handleSubmit">handleSubmit</a></li><li data-type='method'><a href="module-ModalCategoryFormComponent.html#~openModalEditCategory">openModalEditCategory</a></li><li data-type='method'><a href="module-ModalCategoryFormComponent.html#~openModalNewCategory">openModalNewCategory</a></li><li data-type='method'><a href="module-ModalCategoryFormComponent.html#~resetForm">resetForm</a></li><li data-type='method'><a href="module-ModalCategoryFormComponent.html#~setForm">setForm</a></li><li data-type='method'><a href="module-ModalCategoryFormComponent.html#~validateData">validateData</a></li></ul></li><li><a href="module-ModalClientFormComponent.html">ModalClientFormComponent</a><ul class='methods'><li data-type='method'><a href="module-ModalClientFormComponent.html#~closeModal">closeModal</a></li><li data-type='method'><a href="module-ModalClientFormComponent.html#~handleSubmit">handleSubmit</a></li><li data-type='method'><a href="module-ModalClientFormComponent.html#~openModal">openModal</a></li><li data-type='method'><a href="module-ModalClientFormComponent.html#~resetFields">resetFields</a></li><li data-type='method'><a href="module-ModalClientFormComponent.html#~setForm">setForm</a></li><li data-type='method'><a href="module-ModalClientFormComponent.html#~validate">validate</a></li></ul></li><li><a href="module-ModalConfirmComponent.html">ModalConfirmComponent</a><ul class='methods'><li data-type='method'><a href="module-ModalConfirmComponent.html#~closeModalConfirm">closeModalConfirm</a></li><li data-type='method'><a href="module-ModalConfirmComponent.html#~openModalConfirm">openModalConfirm</a></li></ul></li><li><a href="module-ModalProductsForm.html">ModalProductsForm</a><ul class='methods'><li data-type='method'><a href="module-ModalProductsForm.html#~handleChangeQuantity">handleChangeQuantity</a></li><li data-type='method'><a href="module-ModalProductsForm.html#~handleSubmit">handleSubmit</a></li><li data-type='method'><a href="module-ModalProductsForm.html#~openModalEditProduct">openModalEditProduct</a></li><li data-type='method'><a href="module-ModalProductsForm.html#~openModalNewProduct">openModalNewProduct</a></li><li data-type='method'><a href="module-ModalProductsForm.html#~resetFormProducts">resetFormProducts</a></li><li data-type='method'><a href="module-ModalProductsForm.html#~setForm">setForm</a></li><li data-type='method'><a href="module-ModalProductsForm.html#~validateData">validateData</a></li></ul></li><li><a href="module-ModalUserFormComponent.html">ModalUserFormComponent</a><ul class='methods'><li data-type='method'><a href="module-ModalUserFormComponent.html#~closeModal">closeModal</a></li><li data-type='method'><a href="module-ModalUserFormComponent.html#~getForm">getForm</a></li><li data-type='method'><a href="module-ModalUserFormComponent.html#~openModal">openModal</a></li><li data-type='method'><a href="module-ModalUserFormComponent.html#~resetFields">resetFields</a></li><li data-type='method'><a href="module-ModalUserFormComponent.html#~setForm">setForm</a></li><li data-type='method'><a href="module-ModalUserFormComponent.html#~validateForm">validateForm</a></li></ul></li><li><a href="module-string.html">string</a><ul class='methods'><li data-type='method'><a href="module-string.html#~sliceString">sliceString</a></li></ul></li><li><a href="module-time.html">time</a><ul class='methods'><li data-type='method'><a href="module-time.html#~dateSpanish">dateSpanish</a></li><li data-type='method'><a href="module-time.html#~dateToString">dateToString</a></li><li data-type='method'><a href="module-time.html#~showLog">showLog</a></li></ul></li><li><a href="module-UsersModalRole.html">UsersModalRole</a><ul class='methods'><li data-type='method'><a href="module-UsersModalRole.html#~closeModalRole">closeModalRole</a></li><li data-type='method'><a href="module-UsersModalRole.html#~getForm">getForm</a></li><li data-type='method'><a href="module-UsersModalRole.html#~openModalRole">openModalRole</a></li><li data-type='method'><a href="module-UsersModalRole.html#~setForm">setForm</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#clientsTableComponent">clientsTableComponent</a></li><li><a href="global.html#createWindow">createWindow</a></li><li><a href="global.html#CRUD">CRUD</a></li><li><a href="global.html#getPaginationStorage">getPaginationStorage</a></li><li><a href="global.html#getUserLogged">getUserLogged</a></li><li><a href="global.html#hideElement">hideElement</a></li><li><a href="global.html#homeComponent">homeComponent</a></li><li><a href="global.html#modalClientComponent">modalClientComponent</a></li><li><a href="global.html#modalProductsComponent">modalProductsComponent</a></li><li><a href="global.html#mysqlAPI">mysqlAPI</a></li><li><a href="global.html#ordersForm">ordersForm</a></li><li><a href="global.html#ordersTableComponent">ordersTableComponent</a></li><li><a href="global.html#profileModalComponent">profileModalComponent</a></li><li><a href="global.html#redirectTo">redirectTo</a></li><li><a href="global.html#renderErrors">renderErrors</a></li><li><a href="global.html#reportsComponent">reportsComponent</a></li><li><a href="global.html#setPaginationStorage">setPaginationStorage</a></li><li><a href="global.html#setUserLogged">setUserLogged</a></li><li><a href="global.html#showElement">showElement</a></li><li><a href="global.html#usersComponent">usersComponent</a></li><li><a href="global.html#usersTableComponent">usersTableComponent</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">controllers/reporte_controller.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { Notification, dialog, BrowserWindow, ipcMain } = require('electron');
const CRUD = require('../database/CRUD');
const { Database } = require('../database/database');
const FILE = require('../util_functions/file');
const TIME = require('../util_functions/time');
const { ENV } = require('../env');
const { PdfController } = require('./pdf_controller');

/** clase que gestiona los reportes */
class ReporteController {

	/** @type {?Database} */
	databaseInstance = null;

	/** Propiedad get database retorna una nueva instancia de la clase Database */
	static get database() {
		return this.databaseInstance || ( this.databaseInstance = new Database() );
	}

	/**
	 * Busca la totalidad de notas por categoria
	 *
	 * @param  {?Object} periodo periodo de búsqueda
	 * @param {string} periodo.from fecha de incio de búsqueda
	 * @param {string} periodo.to fecha de final de búsqueda
	 * @returns {Promise&lt;(ResponseReport | null)>}
	 * Retorna una promesa con un objeto que contiene los valores preparados para el modelo y la tabla.
	 * Si no hay registros devuelve null.
	 */
	static buscarNotasCategoria( periodo = null ) {

		return new Promise(( resolve, reject ) => {

			const sql = periodo ? CRUD.ObtenerTotalNotasPorCategoriaPeriodo : CRUD.ObtenerTotalNotasPorCategoriaGeneral;

			this.database.consult( sql, periodo, ( error, resultados ) => {

				if ( error ) {

					const notificacion = new Notification({
						title: 'Error !!',
						body: 'Error en la consulta'
					});

					notificacion.show();

					console.log( error );

					reject( error );

					return;
				}

				// console.log( resultados );

				if ( resultados.length > 0 ) {

					let labels = [];
					let data = [];

					for ( let obj of resultados ) {
						labels.push( obj.status );
						data.push( obj.total );
					}

					resolve({ 
						typeChart: 'pie', 
						keys: labels, 
						values: data, 
						results: resultados,
						name_consult: 'buscarNotasCategoria'
					});

					return;
				}

				// En caso de que la consulta venga vacia
				resolve( null );
			});
		});
	}

	/**
	 * Busca la totalidad de notas vendidas por vendedor
	 *
	 * @param  {?Object} periodo periodo de búsqueda
	 * @param {string} periodo.from fecha de incio de búsqueda
	 * @param {string} periodo.to fecha de final de búsqueda
	 * @returns {Promise&lt;(ResponseReport | null)>}
	 * Retorna una promesa con un objeto que contiene los valores preparados para el modelo y la tabla.
	 * Si no hay registros devuelve null.
	*/
	static buscarNotasVendidasPorVendedor( periodo = null ) {

		return new Promise(( resolve, reject ) => {

			const sql =  periodo ? CRUD.ObtenerNotasPorVendedorPeriodo : CRUD.ObtenerNotasPorVendedorGeneral;

			this.database.consult( sql, periodo, ( error, resultados ) => {

				if ( error ) {

					const notificacion = new Notification({
						title: 'Error',
						body: 'Error de la consulta !!'
					});

					notificacion.show();

					console.log( error );

					reject( error );

					return;
				}

				if ( resultados.length > 0 ) {

					let values = [];
					let data = [];

					for ( let obj of resultados ) {
						values.push( obj.cantidad_notas );
						data.push( obj.nombre_vendedor );
					}

					resolve({ 
						typeChart: 'bar', 
						keys: data, 
						values, 
						results: resultados,
						name_consult: 'buscarNotasVendidasPorVendedor'
					});

					return;
				}

				resolve( null );
			});
		});
	}


	/**
	 * Busca la totalidad de productos por categoria
	 *
	 * @returns {Promise&lt;(ResponseReport | null)>}
	 * Retorna una promesa con un objeto que contiene los valores preparados para el modelo y la tabla.
	 * Si no hay registros devuelve null.
	 */
	static buscarTotalProductosPorCategoria() {

		return new Promise(( resolve, reject ) => {

			this.database.consult( CRUD.ObtenerTotalProductosPorCategoria, null, ( error, resultados ) => {

				if ( error ) {

					const notificacion = new Notification({
						title: 'Error',
						body: 'Error de la consulta !!'
					});

					notificacion.show();

					console.log( error );

					reject( error );

					return;
				}

				if ( resultados.length > 0 ) {

					let values = [];
					let data = [];

					for ( let obj of resultados ) {
						data.push( obj.categoria );
						values.push( obj.cantidad_productos );
					}

					resolve({ 
						typeChart: 'pie', 
						keys: data, 
						values,
						results: resultados,
						name_consult: 'buscarTotalProductosPorCategoria'
					});

					return;
				}

				resolve( null );
			});
		});
	}

	/**
	 * Busca la totalidad maxima vendida de cada producto
	 *
	 * @param  {?Object} periodo periodo de búsqueda
	 * @param {string} periodo.from fecha de incio de búsqueda
	 * @param {string} periodo.to fecha de final de búsqueda
	 * @returns {Promise&lt;(ResponseReport | null)>}
	 * Retorna una promesa con un objeto que contiene los valores preparados para el modelo y la tabla.
	 * Si no hay registros devuelve null.
	*/
	static buscarCantidadMaximaVendida( periodo = null ) {
			
		return new Promise(( resolve, reject ) => {
			
			const sql = periodo ? CRUD.ObtenerCantidadMaximaVendidaPeriodo : CRUD.ObtenerCantidadMaximaVendidaGeneral;

			this.database.consult( sql, periodo, ( error, resultados ) => {
				
				if ( error ) {

					const notificacion = new Notification({
						title: 'Error',
						body: 'Error de la consulta !!'
					});

					notificacion.show();

					console.log( error );

					reject( error );

					return;
				}

				if ( resultados.length > 0 ) {

					let values = [];
					let data = [];

					for ( let obj of resultados ) {
						data.push( obj.nombre );
						values.push( obj.cantidad_max_vendida );
					}

					resolve({ 
						typeChart: 'bar', 
						keys: data, 
						values, 
						results: resultados, 
						name_consult: 'buscarCantidadMaximaVendida'
					});

					return;
				}

				resolve( null );
			});
		});
	}

	/**
	 * Busca la totalidad de productos vendidos en el anio actual
	 *
	 * @returns {Promise&lt;(ResponseReport | null)>}
	 * Retorna una promesa con un objeto que contiene los valores preparados para el modelo y la tabla.
	 * Si no hay registros devuelve null.
	 */
	static buscarCantidadProductosVendidosAnual() {
		return new Promise(( resolve, reject ) => {
			
			this.database.consult( CRUD.ObtenerCantidadVendidoAnual, null, ( error, queries ) => {

				if ( error ) {
					
					const notificacion = new Notification({
						title: 'Error',
						body: 'Error en el consulta en la BD!!'
					});

					notificacion.show();

					console.log( error );

					reject( error );

					return;
				}

				const resultados = ReporteController.ordenarMeses( queries[1] );

				if ( resultados.length > 0 ) {
					
					let values = [];
					let data = [];

					for ( let obj of resultados ) {
						data.push( obj.mes );
						values.push( obj.total );
					}

					resolve({ 
						typeChart: 'line', 
						keys: data, 
						values, 
						results: resultados, 
						name_consult: 'buscarCantidadProductosVendidosAnual'
					});

					return;
				}

				resolve( null );
			});
		});
	}

	/**
	 * Permite ordenar los meses del año, según el calendario
	 *
	 * @param  {Array&lt;Object>} resultados array de los resultaods de la base de datos
	 * @returns {Array&lt;{ id: number, mes: string, total: number }>} devuelve el listado de los meses y el total ordenados
	 */
	static ordenarMeses( resultados ) {

		const arrayMeses = [
			{ id: 1, name: 'enero' },
			{ id: 2, name: 'febrero' },
			{ id: 3, name: 'marzo' },
			{ id: 4, name: 'abril' },
			{ id: 5, name: 'mayo' },
			{ id: 6, name: 'junio' },
			{ id: 7, name: 'julio' },
			{ id: 8, name: 'agosto' },
			{ id: 9, name: 'septiembre' },
			{ id: 10, name: 'octubre' },
			{ id: 11, name: 'noviembre' },
			{ id: 12, name: 'diciembre' }
		];

		// transforma a instancias de arrayMeses
		let order = resultados.map(( mounth ) => {

			let find = arrayMeses.find(( mon ) => mon.name === mounth.mes );

			return {
				id:  find.id,
				mes: find.name,
				total: mounth.total
			};
		});

		// console.log( order );

		// ordena con los valores
		order = order.sort(( value, nextValue ) => {

			if ( value.id > nextValue.id ) {
				return 1;

			} else if ( value.id &lt; nextValue.id ) {
				return -1;

			} else {
				return 0;
			}
		});

		// console.log( order );
		return order;
	}

	/**
	 * Funcion que genera el reporte estadistico
	 * @param {Array&lt;ResponseReport>} consults consultas generadas
	 * @returns {Promise&lt;void>} retorna una promesa que se resolvera cuando finalice el reporte
	 */
	static generarReporte( consults ) {

		return new Promise(( resolve, reject ) => {

			const pdfController = new PdfController(); // creas un objeto PDF controller
			
			// genera la fecha del reporte
			let date = TIME.dateSpanish();

			const options = {
				title : 'Guardar Archivo',
				buttonLabel : 'Guardar' ,
				filters : [{ name: 'pdf', extensions: ['pdf'] }],
				defaultPath: FILE.getHomePath('reporte_' + date )
			};

			const notification = new Notification({
				title: 'Éxito',
				body: 'Documento generado con éxito'
			});

			dialog.showSaveDialog( null, options )
				.then( async ( response ) => {
					
					/*	Documentación
					*  response == { canceled: boolean,  filePath: string }
					*  extensions = 'extensiones permitidas'
					*/

					const extensions = ['.pdf'];

					if ( response['canceled'] ) {

						reject({ error: 'cancelled' });

						return;
					}

					// verifica la extension del archivo que sea pdf
					if ( !response['filePath'].includes( extensions[0] ) ) {

						notification['title'] = 'Error !!';
						notification['body'] = 'Extension del archivo no valida';

						notification.show();

						// console.log( response['filePath'] );

						reject({ error: 'extension not valid' });

						return;
					}
				
					consults = await ReporteController.getImageBuffer( consults );
					
					const data = await pdfController.crearReporte( consults );

					FILE.appendFile( response['filePath'], data, ( error ) => {

						if ( error ) {

							console.log( error );

							notification['title'] = 'Error!!';
							notification['body'] = 'Error al guardar archivo';

							notificacion.show();

							// throw error;

							reject({ error });

							return;
						}

						notification.show();

						resolve();
					});
				})
				.catch(( error ) => {
					console.log( error );

					reject( error );
				});
		});
	}

	/**
	 * Obtiene los datos de las imagenes antes de ser generados en el PDF
	 * @param {Array&lt;ResponseReport>} consults  listado de consultas estadisticas
	 * @returns {Promise&lt;Array&lt;ResponseReport>>} Devuelve el mismo listado pero con los datos en buffer de las imagenes
	 * cargados para el diseno PDF
	 */
	static getImageBuffer( consults ) {

		return new Promise(( resolve ) => {

			/**
			 * Para obtener los datos en buffer se necesita que todas las estadisticas
			 * esten conectadas al DOM para ello se crea una ventana modal nueva para poder generar los elementos 
			 * y registrar las imagenes en el buffer.
			 */
	
			let window = new BrowserWindow({
				width: 400,
				height: 300,
				show: false,
				webPreferences: {
					nodeIntegration: true
				}
			});
	
			window.loadFile( FILE.formatUrl( ENV.PATH_VIEWS, 'reports/reports-pdf/reports-pdf.html' ) );
	
			const contents = window.webContents;
			
			// entrada al dom oculto
			
			contents.on('did-finish-load', () => {
				contents.send( 'consults', consults );
			});
	
			// recibe los datos en el buffer
			ipcMain.on('receiveBuffer', ( $event, consultsWindow ) => {
				
				// se valida la instancia de window
				if ( window ) {

					window.close();

					// se limpia la variable de la ventana una vez cerrada para evitar sobrecarga de memoria
					window = null;
				}

				resolve( consultsWindow );
			});	
		});
	}
}

/**
 * ResponseReport
 * @typedef {Object} ResponseReport
 * @property {Array&lt;string>} keys  listado de los nombres usados en el modelo estaditico
 * @property {Array&lt;number>} values listado de valores usados en el modelo estaditico
 * @property {Array&lt;Object>} results listado de la consulta para generar la tabla
 * @property {string} typeChart tipo de diagrama usado para generar los reporte
 * @property {string} name_consult nombre de la consulta
 * @property {Uint8Array} [buffer] datos en bruto de la imagen, este campo se usa al dibujar en el PDF
 * @property {string} [chart] imagen base64 del diagrama
 */

module.exports = {
	ReporteController
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Sun Nov 07 2021 14:28:10 GMT-0400 (Venezuela Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
